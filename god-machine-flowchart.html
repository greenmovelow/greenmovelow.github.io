<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The God Machine: Interactive Flowchart - RDP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="icon" href="assets/gold_green_logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Teko:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-navy-blue: #0A2239;
            --accent-burnished-gold: #D4AF37;
            --background-dark: #121212;
            --text-light: #E0E1DD;
            --text-dark: #1A1A1A;
            --node-background: #F0F0F0;
            --font-display: 'Teko', sans-serif;
            --font-body: 'Roboto Slab', serif;
        }
        body {
            font-family: var(--font-body);
            background-color: var(--primary-navy-blue);
            color: var(--text-light);
        }
        h1, h2, h3, h4 {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--accent-burnished-gold);
        }
        #mynetwork {
            width: 100%;
            height: 75vh;
            border: 2px solid var(--accent-burnished-gold);
            background-color: var(--background-dark);
            border-radius: 8px;
        }
        .node-info-panel {
            background-color: #1a202c;
            border-left: 5px solid var(--accent-burnished-gold);
            padding: 1.5rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
            display: none;
        }
        .node-info-panel.active { display: block; }
        .vis-navigation .vis-button {
            background-color: rgba(10, 34, 57, 0.8);
            border: 1px solid var(--accent-burnished-gold);
            border-radius: 50%;
        }
        .vis-navigation .vis-button:hover { background-color: var(--primary-navy-blue); }
        .vis-navigation .vis-button svg { fill: var(--accent-burnished-gold); }
    </style>
</head>
<body class="antialiased">

    <nav class="sticky top-0 z-50 shadow-lg" style="background-color: rgba(10, 34, 57, 0.9); backdrop-filter: blur(10px);">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                 <a href="the-god-machine.html" class="flex items-center space-x-3 text-gray-300 hover:text-white">
                    <img src="assets/gold_green_logo.png" alt="RDP Logo" class="h-8 w-8">
                    <span class="text-sm font-medium hidden sm:inline">&larr; Return to The God Machine</span>
                </a>
                <h1 class="text-3xl uppercase tracking-wider">Interactive Dossier</h1>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 w-full">
        <header class="text-center pt-4 pb-2">
             <h1 class="text-4xl md:text-5xl font-black uppercase tracking-wider">The God Machine</h1>
        </header>
        <div class="p-4 rounded-lg">
            <div id="mynetwork"></div>
            <div id="node-info" class="node-info-panel">
                <h3 id="info-title" class="text-2xl mb-2"></h3>
                <p id="info-description" class="leading-relaxed"></p>
            </div>
        </div>
    </main>

    <script type="text/javascript">
        var nodes = new vis.DataSet([
            { id: 'daf', label: 'Anonymous Donors (DAFs)', group: 'funding' },
            { id: 'nacl', label: 'NACL', group: 'ops' },
            { id: 'faithwins', label: 'Faith Wins', group: 'ops' },
            { id: 'missiongen', label: 'Mission Generation / NSCA', group: 'credentialer' },
            { id: 'publicschools', label: 'Public Schools', group: 'target' },
            { id: 'chaplains', label: 'NSCA Certified Chaplains', group: 'credentialer' },
            { id: 'rockymalloy', label: 'Rocky Malloy', group: 'individual' }
        ]);
        var edges = new vis.DataSet([
            { from: 'daf', to: 'missiongen', label: 'Funds', title: '$352k Grant x2' },
            { from: 'nacl', to: 'publicschools', label: 'Pushes Legislation' },
            { from: 'faithwins', to: 'nacl', label: 'Lobbies For' },
            { from: 'missiongen', to: 'chaplains', label: 'Certifies' },
            { from: 'chaplains', to: 'publicschools', label: 'Deployed To' },
            { from: 'missiongen', to: 'rockymalloy', label: 'Provides Loan To', title: '$150,000 Loan' },
            { from: 'nacl', to: 'missiongen', label: 'Creates Market For' }
        ]);

        var container = document.getElementById('mynetwork');
        var data = { nodes: nodes, edges: edges };
        
        var options = {
            nodes: {
                shape: 'box',
                font: { face: 'Roboto Slab', size: 14, color: 'var(--text-dark)' }, // DARK text for LIGHT nodes
                borderWidth: 2,
                color: {
                    background: 'var(--node-background)', // LIGHT background for all nodes
                    border: 'var(--primary-navy-blue)',
                    highlight: { background: 'white', border: 'var(--accent-burnished-gold)' }
                },
                widthConstraint: { minimum: 150 },
                shadow: true
            },
            edges: {
                width: 2,
                color: { color: 'var(--text-light)', highlight: 'var(--accent-burnished-gold)' },
                font: { color: 'var(--text-light)', face: 'Roboto Slab', size: 12, strokeWidth: 0, align: 'top' },
                arrows: { to: { enabled: true, scaleFactor: 0.8 } },
                smooth: { type: 'curvedCW', roundness: 0.2 }
            },
            groups: {
                funding: { color: { background: 'var(--accent-burnished-gold)', border: '#A1720A' }, font: { color: 'var(--text-dark)'} },
                individual: { shape: 'ellipse', color: { background: 'var(--accent-burnished-gold)'}, font: { color: 'var(--text-dark)'}},
                target: { color: { background: '#CFD8DC', border: '#90A4AE' }, font: { color: 'var(--text-dark)' } }
            },
            physics: { solver: 'forceAtlas2Based', forceAtlas2Based: { gravitationalConstant: -120, centralGravity: 0.1, springLength: 150 } },
            interaction: { navigationButtons: true, keyboard: true }
        };

        var network = new vis.Network(container, data, options);

        const nodeInfoPanel = document.getElementById('node-info');
        const infoTitle = document.getElementById('info-title');
        const infoDescription = document.getElementById('info-description');
        const nodeDetails = {
            'daf': { title: 'Anonymous Donor-Advised Funds (DAFs)', description: 'The untraceable financial engine. DAFs legally shield the identity of major donors, allowing hundreds of thousands of dollars to flow to Mission Generation without public accountability.' },
            'nacl': { title: 'National Association of Christian Lawmakers (NACL)', description: 'The legislative "bill mill." This group drafts and distributes model legislation to allied state lawmakers, creating the legal framework that allows public schools to hire or accept chaplains.' },
            'faithwins': { title: 'Faith Wins', description: 'The "grassroots" mobilizer. This group manufactures political pressure by organizing clergy and activists to lobby for the NACL\'s bills, creating the appearance of organic public demand.' },
            'missiongen': { title: 'Mission Generation / NSCA', description: 'The credentialing monopoly. By being the primary organization offering "chaplain certification," it captures the market created by its legislative partners. Financial records show it receiving identical $352,000 anonymous grants and providing a $150,000 loan to its founder.' },
            'publicschools': { title: 'Public Schools', description: 'The target. The entire machine is oriented to place its certified, ideologically-aligned personnel inside public schools, often replacing licensed, professional counselors.' },
            'chaplains': { title: 'NSCA Certified Chaplains', description: 'The product. These individuals, requiring only a 40-hour online course, are deployed into schools, creating a pipeline that bypasses professional standards for counseling and mental health support.' },
            'rockymalloy': { title: 'Rocky Malloy', description: 'Founder of Mission Generation, Inc. and recipient of a $150,000 loan from the nonprofit, a transaction identified as a classic red flag for private inurement by the IRS.' }
        };

        network.on("selectNode", function (params) {
            const nodeId = params.nodes[0];
            if (nodeId && nodeDetails[nodeId]) {
                const details = nodeDetails[nodeId];
                infoTitle.textContent = details.title;
                infoDescription.textContent = details.description;
                nodeInfoPanel.classList.add('active');
            } else {
                nodeInfoPanel.classList.remove('active');
            }
        });
        network.on("deselectNode", function () { nodeInfoPanel.classList.remove('active'); });
    </script>
</body>
</html>
