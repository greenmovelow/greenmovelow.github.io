<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The God Machine: Interactive Flowchart - RDP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="icon" href="assets/gold_green_logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Teko:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* NEW COLOR PALETTE: Navy Blue, Burnished Gold, Light Grey */
        :root {
            --primary-navy-blue: #002B4B; /* Deep, authoritative Navy Blue */
            --accent-burnished-gold: #B8860B; /* Desaturated, Burnished Gold */
            --neutral-light-grey: #F0F0F0; /* Cool, clinical Light Grey for backgrounds/text */
            --text-dark: #333333; /* Dark text for light backgrounds */
            --text-light: #E0E1DD; /* Light text for dark backgrounds */
            --background-dark: #1A1A1A; /* For general dark backgrounds */
            --card-background: #252525; /* Slightly lighter dark for card backgrounds */

            --font-display: 'Teko', sans-serif;
            --font-body: 'Roboto Slab', serif;
        }
        body {
            font-family: var(--font-body);
            background-color: var(--primary-navy-blue);
            color: var(--text-light);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        h1, h2, h3, h4 {
            font-family: var(--font-display);
            font-weight: 600;
            color: var(--accent-burnished-gold);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            flex-grow: 1;
        }
        #mynetwork {
            width: 100%;
            height: 600px; /* Increased height for better visualization */
            border: 2px solid var(--accent-burnished-gold);
            background-color: var(--background-dark);
            border-radius: 8px;
            margin-top: 1rem;
        }
        .vis-tooltip {
            background-color: var(--card-background);
            border: 1px solid var(--accent-burnished-gold);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: var(--font-body);
            font-size: 14px;
            color: var(--text-light);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .node-info-panel {
            background-color: var(--card-background);
            border: 1px solid var(--primary-navy-blue);
            border-left: 5px solid var(--accent-burnished-gold);
            padding: 1.5rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
            color: var(--text-light);
            display: none; /* Hidden by default */
        }
        .node-info-panel.active {
            display: block;
        }
        .text-light { color: var(--text-light); }
        .accent-color { color: var(--accent-burnished-gold); }
    </style>
</head>
<body>

    <nav class="sticky top-0 z-50 shadow-lg border-b border-gray-800" style="background-color: rgba(0, 43, 75, 0.8); backdrop-filter: blur(10px);">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <a href="the-god-machine.html" title="Return to The God Machine Report">
                        <img src="assets/gold_green_logo.png" alt="Restoring Democracy's Promise Logo" class="h-8 w-8">
                    </a>
                    <a href="the-god-machine.html" class="text-sm font-medium" style="color: var(--text-light); hover:text-white hover:underline hidden sm:block">
                        &larr; Return to The God Machine
                    </a>
                </div>
                <h1 class="text-3xl uppercase" style="color: var(--accent-burnished-gold);" >Interactive Flowchart</h1>
            </div>
        </div>
    </nav>

    <div class="container">
        <header class="text-center py-6">
            <h1 class="text-4xl md:text-6xl font-black uppercase tracking-wider">THE GOD MACHINE: FLOWCHART</h1>
            <p class="text-xl md:text-2xl accent-color mt-2">Mapping the Network of Influence and Funding</p>
            <p class="text-sm text-light opacity-80 mt-2">An interactive visualization by Restoring Democracy's Promise</p>
        </header>

        <div class="bg-card-dark p-6 rounded-lg shadow-lg">
            <p class="text-light mb-4">Click on any node in the diagram below to learn more about its role in The God Machine network. Hover over nodes for quick information. Use your mouse wheel or pinch-to-zoom to explore the connections.</p>
            <div id="mynetwork"></div>

            <div id="node-info" class="node-info-panel mt-6">
                <h3 id="info-title" class="text-2xl mb-2"></h3>
                <p id="info-description" class="text-light leading-relaxed"></p>
                <div id="info-links" class="mt-4"></div>
            </div>
        </div>
    </div>

    <footer class="border-t py-8 mt-4" style="border-color: var(--primary-navy-blue);">
        <div class="container mx-auto px-4 text-center" style="color: var(--text-secondary);">
            <p>&copy; 2025 Restoring Democracy's Promise. All Rights Reserved.</p>
            <p class="text-sm mt-2">This interactive report is part of the keystone investigation "THE GOD MACHINE."</p>
        </div>
    </footer>

    <script type="text/javascript">
        // Vis.js Network Data
        var nodes = new vis.DataSet([
            { id: 'daf', label: 'Anonymous Donor-Advised Funds (DAFs)', title: 'Source of untraceable grants for the network.', group: 'funding' },
            { id: 'nacl', label: 'National Association of Christian Lawmakers (NACL)', title: 'Drafts model legislation for chaplains in public schools.', group: 'legislation' },
            { id: 'faithwins', label: 'Faith Wins', title: 'Mobilizes "grassroots" pressure campaigns and lobbies for bills.', group: 'mobilization' },
            { id: 'missiongen', label: 'Mission Generation, Inc. (NSCA)', title: 'Sells exclusive chaplain certifications, monopolizing the market created by legislation.', group: 'credentialing' },
            { id: 'publicschools', label: 'Public School Districts', title: 'Target of the legislation and recipient of chaplains.', group: 'target' },
            { id: 'chaplains', label: 'NSCA Certified Chaplains', title: 'Individuals certified by NSCA who serve in public schools.', group: 'credentialing' },
            { id: 'rockymalloy', label: 'Rocky Malloy (Founder)', title: 'Founder of Mission Generation, Inc. Received a significant loan from the organization.', group: 'individual' }
        ]);

        var edges = new vis.DataSet([
            { from: 'daf', to: 'missiongen', arrows: 'to', label: 'Funds', title: 'Provides untraceable grants to Mission Generation.' },
            { from: 'nacl', to: 'publicschools', arrows: 'to', label: 'Pushes Legislation', title: 'NACL drafts and promotes legislation enabling chaplains in schools.' },
            { from: 'faithwins', to: 'nacl', arrows: 'to', label: 'Lobbies/Supports', title: 'Faith Wins lobbies lawmakers for NACL-backed legislation.' },
            { from: 'faithwins', to: 'publicschools', arrows: 'to', label: 'Creates Demand', title: 'Faith Wins creates public pressure for chaplains in schools.' },
            { from: 'missiongen', to: 'chaplains', arrows: 'to', label: 'Certifies', title: 'Mission Generation provides the certification for chaplains.' },
            { from: 'chaplains', to: 'publicschools', arrows: 'to', label: 'Deployed to', title: 'Certified chaplains are placed in public schools.' },
            { from: 'missiongen', to: 'rockymalloy', arrows: 'to', label: 'Provides Loan', title: 'Mission Generation provided a $150,000 loan to its founder, Rocky Malloy.' },
            { from: 'daf', to: 'faithwins', arrows: 'to', label: 'Indirect Funding (Likely)', title: 'Funds may indirectly flow from DAFs to Faith Wins.' },
            { from: 'nacl', to: 'missiongen', arrows: 'to', label: 'Creates Market For', title: 'NACL legislation creates the market for NSCA certifications.' }
        ]);

        // Create a network
        var container = document.getElementById('mynetwork');
        var data = {
            nodes: nodes,
            edges: edges
        };

        var options = {
            nodes: {
                shape: 'box',
                size: 20,
                font: {
                    color: '#FFFFFF', // Text color on nodes
                    face: 'Teko'
                },
                color: {
                    background: 'var(--card-background)',
                    border: 'var(--primary-navy-blue)',
                    highlight: {
                        background: 'var(--card-background)',
                        border: 'var(--accent-burnished-gold)'
                    },
                    hover: {
                        background: 'var(--card-background)',
                        border: 'var(--accent-burnished-gold)'
                    }
                },
                widthConstraint: {
                    minimum: 150
                },
                shadow: true
            },
            edges: {
                width: 2,
                color: {
                    color: 'var(--text-light)', // Color of the edges
                    highlight: 'var(--accent-burnished-gold)',
                    hover: 'var(--accent-burnished-gold)',
                    inherit: 'from',
                    opacity: 0.8
                },
                font: {
                    color: 'var(--text-light)', // Edge label color
                    face: 'Roboto Slab',
                    size: 10,
                    align: 'middle'
                },
                arrows: {
                    to: { enabled: true, scaleFactor: 0.8 }
                },
                smooth: {
                    enabled: true,
                    type: "dynamic",
                    roundness: 0.5
                }
            },
            groups: {
                funding: { color: { background: 'var(--accent-burnished-gold)', border: 'var(--accent-burnished-gold)' }, font: { color: 'var(--text-dark)' } },
                legislation: { color: { background: 'var(--primary-navy-blue)', border: 'var(--accent-burnished-gold)' } },
                mobilization: { color: { background: 'var(--primary-navy-blue)', border: 'var(--accent-burnished-gold)' } },
                credentialing: { color: { background: 'var(--primary-navy-blue)', border: 'var(--accent-burnished-gold)' } },
                target: { color: { background: 'var(--neutral-light-grey)', border: 'var(--accent-burnished-gold)' }, font: { color: 'var(--text-dark)' } },
                individual: { color: { background: 'var(--accent-burnished-gold)', border: 'var(--accent-burnished-gold)' }, font: { color: 'var(--text-dark)' } }
            },
            physics: {
                enabled: true,
                barnesHut: {
                    gravitationalConstant: -2000,
                    centralGravity: 0.3,
                    springLength: 95,
                    springConstant: 0.04,
                    damping: 0.09,
                    avoidOverlap: 0.1
                },
                solver: 'barnesHut',
                adaptiveTimestep: true
            },
            interaction: {
                navigationButtons: true,
                keyboard: true,
                zoomView: true,
                dragView: true
            }
        };

        var network = new vis.Network(container, data, options);

        // Node Information Panel
        const nodeInfoPanel = document.getElementById('node-info');
        const infoTitle = document.getElementById('info-title');
        const infoDescription = document.getElementById('info-description');
        const infoLinks = document.getElementById('info-links');

        const nodeDetails = {
            'daf': {
                title: 'Anonymous Donor-Advised Funds (DAFs)',
                description: 'DAFs provide a mechanism for donors to contribute money anonymously to charitable organizations without revealing their identity. In this network, DAFs serve as the untraceable source of significant funding for entities like Mission Generation, ensuring financial opacity.',
                links: []
            },
            'nacl': {
                title: 'National Association of Christian Lawmakers (NACL)',
                description: 'The NACL is central to the legislative arm, drafting and promoting "model legislation" that directly enables the placement of chaplains in public schools. This creates a regulatory framework and demand for certification services.',
                links: []
            },
            'faithwins': {
                title: 'Faith Wins',
                description: 'This organization is a key mobilizer, responsible for creating the illusion of grassroots demand. They conduct "grassroots" pressure campaigns, mobilizing paid clergy and volunteers to lobby lawmakers and influence policy enactment related to chaplains.',
                links: []
            },
            'missiongen': {
                title: 'Mission Generation, Inc. (National School Chaplain Association - NSCA)',
                description: 'Mission Generation, operating as NSCA, holds a monopoly on chaplain certification for public schools. They sell the "exclusive" credential, capitalizing on the market created by legislation pushed by groups like NACL. Their financial activities, including loans to their founder, are a red flag.',
                links: [
                    { text: 'View Mission Generation (NSCA) Financials', url: 'the-god-machine.html#evidence' }
                ]
            },
            'publicschools': {
                title: 'Public School Districts',
                description: 'These are the ultimate targets of The God Machine. Through coordinated legislative and lobbying efforts, public school districts are pressured into adopting policies that allow for the placement of NSCA-certified chaplains.',
                links: []
            },
            'chaplains': {
                title: 'NSCA Certified Chaplains',
                description: 'These are individuals who have undergone the minimal 40-hour online training provided by NSCA and are subsequently placed into public schools to serve in counseling or support roles, despite lacking professional qualifications.',
                links: [
                    { text: 'Compare Chaplain vs. Counselor Credentials', url: 'credentialing-gap-dossier.html' }
                ]
            },
            'rockymalloy': {
                title: 'Rocky Malloy (Founder of Mission Generation, Inc.)',
                description: 'Rocky Malloy is the founder of Mission Generation. Financial records indicate a significant $150,000 loan from Mission Generation to Malloy, raising questions about private inurement within the tax-exempt organization.',
                links: [
                     { text: 'View Mission Generation (NSCA) Financials', url: 'the-god-machine.html#evidence' }
                ]
            }
        };

        network.on("selectNode", function (params) {
            if (params.nodes.length > 0) {
                var nodeId = params.nodes[0];
                var details = nodeDetails[nodeId];
                if (details) {
                    infoTitle.textContent = details.title;
                    infoDescription.textContent = details.description;
                    infoLinks.innerHTML = '';
                    details.links.forEach(link => {
                        const a = document.createElement('a');
                        a.href = link.url;
                        a.textContent = link.text;
                        a.target = "_blank";
                        a.rel = "noopener noreferrer";
                        a.className = "inline-block bg-primary-navy-blue hover:bg-card-background text-accent-burnished-gold font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-300 mr-2 mt-2 border border-accent-burnished-gold";
                        infoLinks.appendChild(a);
                    });
                    nodeInfoPanel.classList.add('active');
                }
            } else {
                nodeInfoPanel.classList.remove('active');
            }
        });

        network.on("click", function (params) {
            if (params.nodes.length === 0 && params.edges.length === 0) {
                nodeInfoPanel.classList.remove('active');
            }
        });
    </script>
</body>
</html>
